<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Zoho OAuth Token Generator</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      max-width: 800px;
      margin: 50px auto;
      padding: 20px;
      background: #f5f5f5;
    }
    .container {
      background: white;
      padding: 30px;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    h1 {
      color: #333;
      margin-bottom: 10px;
    }
    .subtitle {
      color: #666;
      margin-bottom: 30px;
    }
    .step {
      background: #f9f9f9;
      padding: 20px;
      margin: 20px 0;
      border-left: 4px solid #4CAF50;
      border-radius: 4px;
    }
    .step h3 {
      margin-top: 0;
      color: #4CAF50;
    }
    button {
      background: #4CAF50;
      color: white;
      border: none;
      padding: 12px 24px;
      font-size: 16px;
      border-radius: 4px;
      cursor: pointer;
      margin: 10px 5px;
    }
    button:hover {
      background: #45a049;
    }
    button.secondary {
      background: #2196F3;
    }
    button.secondary:hover {
      background: #0b7dda;
    }
    input, textarea {
      width: 100%;
      padding: 10px;
      margin: 10px 0;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-family: monospace;
      font-size: 14px;
    }
    textarea {
      min-height: 100px;
      resize: vertical;
    }
    .code-block {
      background: #1e1e1e;
      color: #d4d4d4;
      padding: 15px;
      border-radius: 4px;
      overflow-x: auto;
      margin: 10px 0;
      font-family: 'Courier New', monospace;
      font-size: 13px;
    }
    .success {
      background: #d4edda;
      color: #155724;
      padding: 15px;
      border-radius: 4px;
      margin: 15px 0;
      border: 1px solid #c3e6cb;
    }
    .error {
      background: #f8d7da;
      color: #721c24;
      padding: 15px;
      border-radius: 4px;
      margin: 15px 0;
      border: 1px solid #f5c6cb;
    }
    .info {
      background: #d1ecf1;
      color: #0c5460;
      padding: 15px;
      border-radius: 4px;
      margin: 15px 0;
      border: 1px solid #bee5eb;
    }
    label {
      display: block;
      margin-top: 15px;
      font-weight: bold;
      color: #333;
    }
    .hidden {
      display: none;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üîê Zoho OAuth Token Generator</h1>
    <p class="subtitle">Generate OAuth tokens for Zoho Creator Bulk Read API</p>

    <!-- Step 1: Configuration -->
    <div class="step">
      <h3>Step 1: Configuration</h3>
      <p>Your credentials have been pre-filled:</p>

      <label>Client ID:</label>
      <input type="text" id="clientId" value="1000.RJQQGXZ5O9YWORFH1JUF4J616S1T4W" readonly>

      <label>Client Secret:</label>
      <input type="text" id="clientSecret" value="6b8d93c6733bcfa07327353341b038d70f7d97cdfe" readonly>

      <label>Redirect URI:</label>
      <input type="text" id="redirectUri" value="http://localhost:5173/oauth-callback" readonly>

      <label>Scope:</label>
      <input type="text" id="scope" value="ZohoCreator.bulk.READ,ZohoCreator.report.READ" readonly>
    </div>

    <!-- Step 2: Get Authorization Code -->
    <div class="step">
      <h3>Step 2: Get Authorization Code</h3>
      <p>Click the button below to open Zoho's authorization page:</p>
      <button onclick="getAuthCode()">üîó Open Zoho Authorization Page</button>

      <div class="info" style="margin-top: 15px;">
        <strong>Instructions:</strong><br>
        1. Click the button above<br>
        2. Log in to your Zoho account<br>
        3. Click "Accept" to authorize<br>
        4. You'll be redirected to a page with an authorization code<br>
        5. Copy the code from the URL and paste it below
      </div>

      <label>Authorization Code (paste here):</label>
      <input type="text" id="authCode" placeholder="Paste the authorization code from the URL">

      <button class="secondary" onclick="exchangeCode()">üîÑ Exchange Code for Token</button>
    </div>

    <!-- Step 3: Results -->
    <div class="step" id="resultsStep" class="hidden">
      <h3>Step 3: Your OAuth Token</h3>
      <div id="results"></div>
    </div>

    <!-- Step 4: Update .env -->
    <div class="step" id="envStep" class="hidden">
      <h3>Step 4: Update Your .env File</h3>
      <p>Add these lines to your <code>.env</code> file:</p>
      <textarea id="envVars" readonly></textarea>
      <button onclick="copyEnvVars()">üìã Copy to Clipboard</button>
    </div>
  </div>

  <script>
    const CLIENT_ID = '1000.RJQQGXZ5O9YWORFH1JUF4J616S1T4W';
    const CLIENT_SECRET = '6b8d93c6733bcfa07327353341b038d70f7d97cdfe';
    const REDIRECT_URI = 'http://localhost:5173/oauth-callback';
    const SCOPE = 'ZohoCreator.bulk.READ,ZohoCreator.report.READ';

    function getAuthCode() {
      const authUrl = `https://accounts.zoho.com/oauth/v2/auth?` +
        `response_type=code&` +
        `client_id=${CLIENT_ID}&` +
        `scope=${encodeURIComponent(SCOPE)}&` +
        `redirect_uri=${encodeURIComponent(REDIRECT_URI)}&` +
        `access_type=offline&` +
        `prompt=consent`;

      window.open(authUrl, '_blank');

      showInfo('Authorization window opened. Follow the instructions, then paste the code below.');
    }

    async function exchangeCode() {
      const authCode = document.getElementById('authCode').value.trim();

      if (!authCode) {
        showError('Please enter the authorization code');
        return;
      }

      showInfo('Exchanging authorization code for tokens...');

      try {
        const response = await fetch('https://accounts.zoho.com/oauth/v2/token', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/x-www-form-urlencoded'
          },
          body: new URLSearchParams({
            code: authCode,
            client_id: CLIENT_ID,
            client_secret: CLIENT_SECRET,
            redirect_uri: REDIRECT_URI,
            grant_type: 'authorization_code'
          })
        });

        const data = await response.json();

        if (data.error) {
          showError('Error: ' + data.error);
          return;
        }

        if (!data.access_token) {
          showError('No access token received. Response: ' + JSON.stringify(data));
          return;
        }

        // Success!
        displayResults(data);
        generateEnvVars(data);

      } catch (error) {
        showError('Network error: ' + error.message);
      }
    }

    function displayResults(data) {
      const resultsDiv = document.getElementById('results');
      const resultsStep = document.getElementById('resultsStep');

      resultsStep.classList.remove('hidden');

      resultsDiv.innerHTML = `
        <div class="success">
          <strong>‚úÖ Success! OAuth tokens generated</strong>
        </div>

        <label>Access Token (valid for 1 hour):</label>
        <textarea readonly>${data.access_token}</textarea>

        <label>Refresh Token (use to get new access tokens):</label>
        <textarea readonly>${data.refresh_token}</textarea>

        <div class="info">
          <strong>Token Details:</strong><br>
          ‚Ä¢ Expires in: ${data.expires_in} seconds (${Math.round(data.expires_in / 60)} minutes)<br>
          ‚Ä¢ API Domain: ${data.api_domain}<br>
          ‚Ä¢ Token Type: ${data.token_type}
        </div>
      `;

      // Scroll to results
      resultsStep.scrollIntoView({ behavior: 'smooth' });
    }

    function generateEnvVars(data) {
      const envVarsTextarea = document.getElementById('envVars');
      const envStep = document.getElementById('envStep');

      envStep.classList.remove('hidden');

      const envContent = `# Zoho OAuth Configuration
VITE_ZOHO_BASE_URL=https://www.zohoapis.com
VITE_ZOHO_ACCOUNT_OWNER=hsbvnu
VITE_ZOHO_APP_LINK_NAME=hsbvnu

# OAuth Tokens (REQUIRED for bulk read)
VITE_ZOHO_OAUTH_TOKEN=${data.access_token}
VITE_ZOHO_REFRESH_TOKEN=${data.refresh_token}
VITE_ZOHO_CLIENT_ID=${CLIENT_ID}
VITE_ZOHO_CLIENT_SECRET=${CLIENT_SECRET}

# Legacy Public Keys (optional)
VITE_ZOHO_STUDENTS_PUBLIC_KEY=your_students_public_key_here
VITE_ZOHO_LECTURERS_PUBLIC_KEY=your_lecturers_public_key_here`;

      envVarsTextarea.value = envContent;

      envStep.scrollIntoView({ behavior: 'smooth' });
    }

    function copyEnvVars() {
      const textarea = document.getElementById('envVars');
      textarea.select();
      document.execCommand('copy');
      showSuccess('Environment variables copied to clipboard!');
    }

    function showInfo(message) {
      const resultsDiv = document.getElementById('results');
      resultsDiv.innerHTML = `<div class="info">${message}</div>`;
      document.getElementById('resultsStep').classList.remove('hidden');
    }

    function showError(message) {
      const resultsDiv = document.getElementById('results');
      resultsDiv.innerHTML = `<div class="error"><strong>‚ùå Error:</strong><br>${message}</div>`;
      document.getElementById('resultsStep').classList.remove('hidden');
    }

    function showSuccess(message) {
      const resultsDiv = document.getElementById('results');
      resultsDiv.innerHTML = `<div class="success">${message}</div>`;
      document.getElementById('resultsStep').classList.remove('hidden');
      setTimeout(() => {
        document.getElementById('resultsStep').classList.add('hidden');
      }, 3000);
    }
  </script>
</body>
</html>
