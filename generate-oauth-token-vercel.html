<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Zoho OAuth Token Generator (Vercel)</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      max-width: 900px;
      margin: 50px auto;
      padding: 20px;
      background: #f5f5f5;
    }
    .container {
      background: white;
      padding: 30px;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    h1 {
      color: #333;
      margin-bottom: 10px;
    }
    .subtitle {
      color: #666;
      margin-bottom: 30px;
    }
    .step {
      background: #f9f9f9;
      padding: 20px;
      margin: 20px 0;
      border-left: 4px solid #4CAF50;
      border-radius: 4px;
    }
    .step h3 {
      margin-top: 0;
      color: #4CAF50;
    }
    button {
      background: #4CAF50;
      color: white;
      border: none;
      padding: 12px 24px;
      font-size: 16px;
      border-radius: 4px;
      cursor: pointer;
      margin: 10px 5px;
    }
    button:hover {
      background: #45a049;
    }
    button.secondary {
      background: #2196F3;
    }
    button.secondary:hover {
      background: #0b7dda;
    }
    input, textarea {
      width: 100%;
      padding: 10px;
      margin: 10px 0;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-family: monospace;
      font-size: 14px;
      box-sizing: border-box;
    }
    textarea {
      min-height: 100px;
      resize: vertical;
    }
    .success {
      background: #d4edda;
      color: #155724;
      padding: 15px;
      border-radius: 4px;
      margin: 15px 0;
      border: 1px solid #c3e6cb;
    }
    .error {
      background: #f8d7da;
      color: #721c24;
      padding: 15px;
      border-radius: 4px;
      margin: 15px 0;
      border: 1px solid #f5c6cb;
    }
    .info {
      background: #d1ecf1;
      color: #0c5460;
      padding: 15px;
      border-radius: 4px;
      margin: 15px 0;
      border: 1px solid #bee5eb;
    }
    .warning {
      background: #fff3cd;
      color: #856404;
      padding: 15px;
      border-radius: 4px;
      margin: 15px 0;
      border: 1px solid #ffeeba;
    }
    label {
      display: block;
      margin-top: 15px;
      font-weight: bold;
      color: #333;
    }
    .hidden {
      display: none;
    }
    code {
      background: #f4f4f4;
      padding: 2px 6px;
      border-radius: 3px;
      font-family: 'Courier New', monospace;
    }
    .vercel-badge {
      display: inline-block;
      background: #000;
      color: white;
      padding: 8px 16px;
      border-radius: 4px;
      font-weight: bold;
      margin: 10px 0;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üîê Zoho OAuth Token Generator</h1>
    <p class="subtitle">Generate OAuth tokens for Zoho Creator Bulk Read API (using Vercel)</p>

    <!-- Step 0: Vercel Setup -->
    <div class="step">
      <h3>Step 0: Deploy OAuth Callback to Vercel (One-time setup)</h3>

      <div class="warning" id="vercelWarning">
        <strong>‚ö†Ô∏è Important:</strong> You need to deploy the OAuth callback to Vercel first!
      </div>

      <p><strong>Quick Deploy:</strong></p>
      <ol>
        <li>Install Vercel CLI: <code>npm install -g vercel</code></li>
        <li>Login to Vercel: <code>vercel login</code></li>
        <li>Deploy this project: <code>vercel</code></li>
        <li>Copy your Vercel URL and paste it below</li>
      </ol>

      <label>Your Vercel URL:</label>
      <input type="text" id="vercelUrl" placeholder="https://your-project.vercel.app" onchange="updateRedirectUri()">

      <div class="info" style="margin-top: 15px;">
        <strong>Don't have Vercel yet?</strong><br>
        1. Go to <a href="https://vercel.com" target="_blank">vercel.com</a><br>
        2. Sign up with GitHub<br>
        3. Import this repository<br>
        4. Deploy (it's free!)
      </div>
    </div>

    <!-- Step 1: Configuration -->
    <div class="step">
      <h3>Step 1: Configuration</h3>
      <p>Your Zoho credentials:</p>

      <label>Client ID:</label>
      <input type="text" id="clientId" value="1000.RJQQGXZ5O9YWORFH1JUF4J616S1T4W" readonly>

      <label>Client Secret:</label>
      <input type="text" id="clientSecret" value="6b8d93c6733bcfa07327353341b038d70f7d97cdfe" readonly>

      <label>Redirect URI (auto-generated):</label>
      <input type="text" id="redirectUri" readonly placeholder="Enter Vercel URL above first">

      <label>Scope:</label>
      <input type="text" id="scope" value="ZohoCreator.bulk.READ,ZohoCreator.report.READ,ZohoCreator.report.CREATE,ZohoCreator.report.UPDATE" readonly>

      <div class="warning" style="margin-top: 15px;">
        <strong>‚ö†Ô∏è Add Redirect URI to Zoho:</strong><br>
        1. Go to <a href="https://api-console.zoho.com/" target="_blank">Zoho API Console</a><br>
        2. Open your client: <code>1000.RJQQGXZ5O9YWORFH1JUF4J616S1T4W</code><br>
        3. Add this redirect URI: <strong id="redirectUriDisplay">Enter Vercel URL first</strong><br>
        4. Click "Update"
      </div>
    </div>

    <!-- Step 2: Get Authorization Code -->
    <div class="step">
      <h3>Step 2: Get Authorization Code</h3>
      <p>Click the button below to authorize with Zoho:</p>
      <button onclick="getAuthCode()" id="authButton" disabled>üîó Open Zoho Authorization Page</button>

      <div class="info" style="margin-top: 15px;">
        <strong>What happens next:</strong><br>
        1. You'll be redirected to Zoho<br>
        2. Log in and click "Accept"<br>
        3. Vercel will show your authorization code<br>
        4. Copy the code and paste it below
      </div>

      <label>Authorization Code:</label>
      <input type="text" id="authCode" placeholder="Paste the authorization code here">

      <button class="secondary" onclick="exchangeCode()">üîÑ Exchange Code for Token</button>
    </div>

    <!-- Step 3: Results -->
    <div class="step hidden" id="resultsStep">
      <h3>Step 3: Your OAuth Tokens</h3>
      <div id="results"></div>
    </div>

    <!-- Step 4: Update .env -->
    <div class="step hidden" id="envStep">
      <h3>Step 4: Update Your .env File</h3>
      <p>Copy and paste this into your <code>.env</code> file:</p>
      <textarea id="envVars" readonly></textarea>
      <button onclick="copyEnvVars()">üìã Copy to Clipboard</button>
    </div>
  </div>

  <script>
    const CLIENT_ID = '1000.RJQQGXZ5O9YWORFH1JUF4J616S1T4W';
    const CLIENT_SECRET = '6b8d93c6733bcfa07327353341b038d70f7d97cdfe';
    const SCOPE = 'ZohoCreator.bulk.READ,ZohoCreator.report.READ,ZohoCreator.report.CREATE,ZohoCreator.report.UPDATE';

    let REDIRECT_URI = '';

    function updateRedirectUri() {
      const vercelUrl = document.getElementById('vercelUrl').value.trim();

      if (!vercelUrl) {
        document.getElementById('authButton').disabled = true;
        return;
      }

      // Remove trailing slash if present
      const baseUrl = vercelUrl.replace(/\/$/, '');
      REDIRECT_URI = `${baseUrl}/api/oauth-callback`;

      document.getElementById('redirectUri').value = REDIRECT_URI;
      document.getElementById('redirectUriDisplay').textContent = REDIRECT_URI;
      document.getElementById('authButton').disabled = false;

      // Hide warning if URL is set
      document.getElementById('vercelWarning').style.display = 'none';
    }

    function getAuthCode() {
      if (!REDIRECT_URI) {
        alert('Please enter your Vercel URL first');
        return;
      }

      const authUrl = `https://accounts.zoho.com/oauth/v2/auth?` +
        `response_type=code&` +
        `client_id=${CLIENT_ID}&` +
        `scope=${encodeURIComponent(SCOPE)}&` +
        `redirect_uri=${encodeURIComponent(REDIRECT_URI)}&` +
        `access_type=offline&` +
        `prompt=consent`;

      window.open(authUrl, '_blank', 'width=800,height=600');

      showInfo('Authorization window opened. Follow the instructions, then paste the code below.');
    }

    async function exchangeCode() {
      const authCode = document.getElementById('authCode').value.trim();

      if (!authCode) {
        showError('Please enter the authorization code');
        return;
      }

      if (!REDIRECT_URI) {
        showError('Please enter your Vercel URL first');
        return;
      }

      showInfo('Exchanging authorization code for tokens...');

      try {
        const response = await fetch('https://accounts.zoho.com/oauth/v2/token', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/x-www-form-urlencoded'
          },
          body: new URLSearchParams({
            code: authCode,
            client_id: CLIENT_ID,
            client_secret: CLIENT_SECRET,
            redirect_uri: REDIRECT_URI,
            grant_type: 'authorization_code'
          })
        });

        const data = await response.json();

        if (data.error) {
          showError('Error: ' + data.error);
          return;
        }

        if (!data.access_token) {
          showError('No access token received. Response: ' + JSON.stringify(data));
          return;
        }

        // Success!
        displayResults(data);
        generateEnvVars(data);

      } catch (error) {
        showError('Network error: ' + error.message);
      }
    }

    function displayResults(data) {
      const resultsDiv = document.getElementById('results');
      const resultsStep = document.getElementById('resultsStep');

      resultsStep.classList.remove('hidden');

      resultsDiv.innerHTML = `
        <div class="success">
          <strong>‚úÖ Success! OAuth tokens generated</strong>
        </div>

        <label>Access Token (valid for 1 hour):</label>
        <textarea readonly>${data.access_token}</textarea>

        <label>Refresh Token (use to get new access tokens):</label>
        <textarea readonly>${data.refresh_token}</textarea>

        <div class="info">
          <strong>Token Details:</strong><br>
          ‚Ä¢ Expires in: ${data.expires_in} seconds (${Math.round(data.expires_in / 60)} minutes)<br>
          ‚Ä¢ API Domain: ${data.api_domain}<br>
          ‚Ä¢ Token Type: ${data.token_type}
        </div>
      `;

      resultsStep.scrollIntoView({ behavior: 'smooth' });
    }

    function generateEnvVars(data) {
      const envVarsTextarea = document.getElementById('envVars');
      const envStep = document.getElementById('envStep');

      envStep.classList.remove('hidden');

      const envContent = `# Zoho OAuth Configuration
VITE_ZOHO_BASE_URL=https://www.zohoapis.com
VITE_ZOHO_ACCOUNT_OWNER=hsbvnu
VITE_ZOHO_APP_LINK_NAME=hsbvnu

# OAuth Credentials
VITE_ZOHO_CLIENT_ID=${CLIENT_ID}
VITE_ZOHO_CLIENT_SECRET=${CLIENT_SECRET}

# OAuth Tokens (REQUIRED for bulk read)
VITE_ZOHO_OAUTH_TOKEN=${data.access_token}
VITE_ZOHO_REFRESH_TOKEN=${data.refresh_token}

# Vercel Redirect URI
VITE_ZOHO_REDIRECT_URI=${REDIRECT_URI}`;

      envVarsTextarea.value = envContent;

      envStep.scrollIntoView({ behavior: 'smooth' });
    }

    function copyEnvVars() {
      const textarea = document.getElementById('envVars');
      textarea.select();
      document.execCommand('copy');
      showSuccess('Environment variables copied to clipboard!');
    }

    function showInfo(message) {
      const resultsDiv = document.getElementById('results');
      resultsDiv.innerHTML = `<div class="info">${message}</div>`;
      document.getElementById('resultsStep').classList.remove('hidden');
    }

    function showError(message) {
      const resultsDiv = document.getElementById('results');
      resultsDiv.innerHTML = `<div class="error"><strong>‚ùå Error:</strong><br>${message}</div>`;
      document.getElementById('resultsStep').classList.remove('hidden');
    }

    function showSuccess(message) {
      const resultsDiv = document.getElementById('results');
      const tempDiv = document.createElement('div');
      tempDiv.className = 'success';
      tempDiv.textContent = message;
      resultsDiv.appendChild(tempDiv);
      setTimeout(() => {
        tempDiv.remove();
      }, 3000);
    }
  </script>
</body>
</html>
